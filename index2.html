<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zoom y dibujo en Canvas</title>
<style>
    canvas {
        border: 1px solid black;
        height: 80vh;
        width: auto;
        display: block;
        margin: auto;
    }
</style>
</head>
<body>
<input type="file" id="fileInput">
<br>
<button id="zoomInButton">Zoom In</button>
<button id="zoomOutButton">Zoom Out</button>
<button id="drawRectButton">Dibujar Rectángulo</button>
<br>
<canvas id="canvas"></canvas>
<div id="coordinates"></div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let image;
    let originalImage;
    let zoom = 1;

    document.getElementById('fileInput').addEventListener('change', function(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                originalImage = img;
                resetImage();
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });

    document.getElementById('zoomInButton').addEventListener('click', function() {
        zoom *= 1.2;
        drawImage();
    });

    document.getElementById('zoomOutButton').addEventListener('click', function() {
		if (zoom > 1) {
			zoom /= 1.2;
			drawImage();
		}
    });

    document.getElementById('drawRectButton').addEventListener('click', function() {
        canvas.addEventListener('mousedown', startDrawing);
    });

    function resetImage() {
        zoom = 1;
        image = new Image();
        image.src = originalImage.src;
        drawImage();
    }

    function drawImage() {
        canvas.width = originalImage.width;
        canvas.height = originalImage.height;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(image, 0, 0, canvas.width * zoom, canvas.height * zoom);
    }

    function startDrawing(event) {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        const initialX = x / zoom;
        const initialY = y / zoom;

        canvas.removeEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', drawRect);
        canvas.addEventListener('mouseup', stopDrawing);

        function drawRect(event) {
            const rectX = event.clientX - rect.left;
            const rectY = event.clientY - rect.top;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(image, 0, 0, canvas.width * zoom, canvas.height * zoom);
            ctx.strokeStyle = 'red';
			ctx.strokeRect(initialX * zoom, initialY * zoom, (rectX - initialX) * zoom, (rectY - initialY) * zoom);

        }

        function stopDrawing() {
            canvas.removeEventListener('mousemove', drawRect);
            canvas.removeEventListener('mouseup', stopDrawing);
            const finalX = event.clientX - rect.left;
            const finalY = event.clientY - rect.top;
            console.log('Coordenadas del rectángulo:', {x1: initialX, y1: initialY, x2: finalX, y2: finalY});
			document.getElementById('coordinates').textContent = `x1: ${initialX}, y1: ${initialY}, x2: ${finalX / zoom}, y2: ${finalY / zoom}`;
        }
    }
</script>
</body>
</html>
